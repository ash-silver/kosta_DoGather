<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mapper.ProductMapper">
	<resultMap type="com.project.model.Product" id="ProductMap">
		<id property="p_id" column="p_id" />
		<result property="p_name" column="p_name" />
		<result property="p_price" column="p_price" />
		<result property="p_min_quantity" column="p_min_quantity" />
		<result property="p_max_quantity" column="p_max_quantity" />
		<result property="p_category" column="p_category" />
		<result property="p_due_date" column="p_due_date" />
		<result property="p_recruit_date" column="p_recruit_date" />
		<result property="p_create_date" column="p_create_date" />
		<result property="p_writer" column="p_writer" />
		<result property="p_chk" column="p_chk" />
		
	</resultMap>
	<resultMap type="com.project.model.Img" id="ImgMap">
		<id property="img_num" column="img_num" />
		<result property="img_name" column="img_name" />
		<result property="img_origname" column="img_origname" />
		<result property="img_pid" column="img_pid" />
		<result property="img_keyword" column="img_keyword" />
		<collection property="product" resultMap="ProductMap"></collection>
	</resultMap>

	<insert id="AddProduct"
		parameterType="com.project.model.Product" useGeneratedKeys="true"
		keyProperty="p_id">
		INSERT INTO product(
		p_name,p_price,p_min_quantity,p_max_quantity,p_category,p_due_date,p_recruit_date,p_create_date,p_writer
		)
		VALUES(
		#{p_name}
		,#{p_price}
		,#{p_min_quantity}
		,#{p_max_quantity}
		,#{p_category}
		,#{p_due_date}
		,#{p_recruit_date}
		,now()
		,#{p_writer}
		)
	</insert>

	<select id="FindProduct" parameterType="int"
		resultMap="ImgMap">
		SELECT
		p.p_name,p.p_price,p.p_min_quantity,p.p_max_quantity,p.p_category,
		p.p_due_date,p.p_recruit_date,p.p_writer,i.img_name,i.img_keyword
		FROM
		Product AS p RIGHT OUTER JOIN img AS i
		ON p.p_id=i.img_pid
		WHERE
		p.p_id=#{p_id}
	</select>

	<insert id="AddOption" parameterType="com.project.model.Option">
		INSERT INTO opt VALUES(
		#{opt_pid},#{opt_option1},#{opt_option2},#{opt_quantity}
		)
	</insert>

	<insert id="AddImg" parameterType="com.project.model.Img">
		INSERT INTO Img VALUES(
		0,#{img_name},#{img_origname},#{img_pid},#{img_keyword}
		)
	</insert>
</mapper>